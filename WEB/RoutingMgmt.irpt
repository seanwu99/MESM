<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>CT MODULE</title>
	<style>
	body{
		background-image: url("Common/img/logo.png");
		background-size: 180px;
		background-repeat: no-repeat;
    		background-attachment: fixed;
    		background-position: right 40px top 30px;
		font-family: Arial;
	}
	#app_header {
 		padding: 10px;
 		padding-left: 40px;
 		padding-top: 15px;
 		padding-bottom: 0px;
		height:80px;
		width:400px;
		text-align: center;
	}
	#app_title {
		width:400px;
		text-align: center;
		font-family: "Arial Black",Arial,Helvetica,sans-serif;
		font-size:32px;
		color: #007dc0;
		margin-bottom; 20px;
	}
	#app_menu {
		width:400px;
		text-align: center;
		font-family: Arial,Helvetica,sans-serif;
	}
	#page_title {
		width:400px;
		text-align: center;
		font-family: "Arial Black",Arial,Helvetica,sans-serif;
		font-size:28px;
		color: #cfcfcf;
	}
	#mesm_content {
 		padding: 30px;
 		padding-top: 40px;
	}
	#__button0, #__button1, #__button2 {
		margin-top:10px;
		margin-left:5px;
		margin-right:5px;
	}
	#MatrixT, #MatrixB, #MatrixA, #MatrixE, #MatrixV,#MatrixP {
		margin:10px auto;
	}
	#MatrixMail,#MatrixMailF{
		margin:10px auto;
	}
 	#__cell4 {
		padding-left:35px;
	} 
 	#__cell9 {
		text-align:right;
	} 
 	#__cell11, #__cell12,#__cell13, #__cell14, #__cell15 {
		text-align:center;
	} 
	
	#B-New,#B-Edit,#B-Delete {
		width:100px;
		height:35px;
		font-size:14px;
	}
	#MatrixAR , #MatrixER {
		margin:0px auto;
	}

	#L-AddRouting, #L-EditRouting {
		margin-top:15px;
		padding:5px;
		font-family: "Arial Black",Arial,Helvetica,sans-serif;
		font-size:32px;
		height:35px;
		color: #007dc0;
	}

	#B-NewAR,  #B-NewER{
		margin-top:10px;
		width:100px;
		height:35px;
		font-size:14px;
	}

	#__cell16 {
		text-align:center;
	}

	 #__cell17,  #__cell19, #__cell21,  #__cell23{
		padding:10px;
		padding-right:20px;
		text-align:right;
	}

	#__cell26 {
		text-align:center;
	}

	#__cell27 {
		text-align:center;
	}

	 #__cell28, #__cell30,  #__cell32,  #__cell34{
		padding:10px;
		padding-right:20px;
		text-align:right;
	}

	#__cell37 {
		text-align:center;
	}
	</style>

	<link rel="stylesheet" type="text/css" media="print" href="Common/css/print.css" />
	<script id="sap-ui-bootstrap"
		src="/sapui5/resources/sap-ui-core.js"
		data-sap-ui-theme="sap_goldreflection"
		data-sap-ui-libs="sap.ui.core,sap.ui.commons,sap.ui.table,sap.ui.ux3,sap.m"
		data-sap-ui-language="en" >
	</script>
	<script type="text/javascript" src="Common/js/default.js"></script>

	<script type="text/javascript" id="app-init">
	// ******************************************************************************************************************************************************************
	// Get Core SAP UI5
	var oCore = sap.ui.getCore();
	// Initialize screen
	var nrRows = 13;
	var selectedIndex =  -1;
	// ******************************************************************************************************************************************************************
	// initialize access
	var level2Access = "";
	var plant2Access = "";
	// Initialize screen
	var selectedPlant = 0;
	var selectedPlantAR = 0;
	var selectedPlantER = 0;
	var user_name = "";

	// FILTERS
	var selectedLine = 0;
 	var selectedTransaction = 0;

	// EDIT	
	var selectedRoutingRecordID = -1;
	var selectedOrderTypeID = 0;
	var selectedStationID = 0;
	var selectedTransactionID = 0;
	var selectedOperationSap = 0;

	var tableCreated = 0;

	// ******************************************************************************************************************************************************************
	function roleSecurity() {
		var myRoles = document.getElementById("user_roles").value;
		var role2Access = "MESM_" + document.getElementById("user_role").value;
		user_name = document.getElementById("user_name").value;
		if(myRoles.indexOf(role2Access)<0) {
			 window.location.assign("security.irpt");
		  } else {
			var roleString = document.getElementById("user_role").value;
			var roleArray = roleString.split("_");
			level2Access = roleArray[0]; 
				// alert("level : " + level2Access);
			plant2Access =  roleArray[1];
				// alert("plant : " + plant2Access);
			updatePlants(plant2Access);
			document.getElementById("page_title").innerHTML=role2Access;
			// enable homepage
			oCore.byId("item3-0-3").setEnabled(true);
			// show menus
			oMenuButton1.placeAt("app_menu");
			oMenuButton2.placeAt("app_menu");
			oMenuButton3.placeAt("app_menu");
			var role_ADM = "MESM_ADM_"+plant2Access;
			var role_ENG = "MESM_ENG_"+plant2Access;
			var role_SUP = "MESM_SUP_"+plant2Access;
			var role_OPS = "MESM_OPS_"+plant2Access;

			switch(role2Access) {
			case "MESM_ADM_ALL":

				// enable Cfg Hierarchy
					oCore.byId("item1-0-1").setEnabled(true);
				// enable Cfg Memory Maps
					oCore.byId("item1-0-3").setEnabled(true);
				// enable Cfg Connectivity
					oCore.byId("item1-0-4").setEnabled(true);
				// enable Master Data
					oCore.byId("item1-0-5").setEnabled(true);

				// SPC
				// enable SPC home page
					oCore.byId("item1-0-6").setEnabled(true);
				// enable Plants submenu
					oCore.byId("item1-0-7").setEnabled(true);
				// enable  Stations submenu
					oCore.byId("item1-0-8").setEnabled(true);
				// enable Part submenu
					oCore.byId("item1-0-9").setEnabled(true);
				// enable Datapoints submenu
					oCore.byId("item1-0-10").setEnabled(true);
				// enable Operators submenu
					oCore.byId("item1-0-11").setEnabled(true);
				// enable Subscriptions submenu
					oCore.byId("item1-0-12").setEnabled(true);

				// enable WO Management
					oCore.byId("item2-0-1").setEnabled(true);
				// enable Carrier Station Dashboard
					oCore.byId("item2-0-2").setEnabled(true);
				// enable Assembly Station Dashboard
					oCore.byId("item2-0-3").setEnabled(true);

				// SPC
				// enable SPC Dashboard
					oCore.byId("item2-0-4").setEnabled(true);
				// enable Saved File Charts
					//	oCore.byId("item2-0-5").setEnabled(true);
				// enable  PC History Logs
					//	oCore.byId("item2-0-6").setEnabled(true);

				// enable Production Status Shifts Report
					oCore.byId("item3-0-1").setEnabled(true);
				// enable Item Traceability Report
					oCore.byId("item3-0-2").setEnabled(true);
				// enable Connector Diagnostics
					oCore.byId("item3-0-3").setEnabled(true);

				// SPC
				// enable Daily Activity
					oCore.byId("item3-0-4").setEnabled(true);
				// enable Weekly Activity
					oCore.byId("item3-0-5").setEnabled(true);
				// enable onthly Activity
					oCore.byId("item3-0-6").setEnabled(true);

				// enable Equipment Hierarchy
					oCore.byId("item1-4-1").setEnabled(true);
				// enable Cfg Hierarchy Levels
					oCore.byId("item1-4-2").setEnabled(true);

				// enable Cfg Memory Maps
					oCore.byId("item1-5-1").setEnabled(true);
				// enable Cfg Tag Types
					oCore.byId("item1-5-2").setEnabled(true);
				// enable Cfg Tag Functions
					oCore.byId("item1-5-3").setEnabled(true);
				// enable Cfg Tag Groups
					oCore.byId("item1-5-4").setEnabled(true);
				// enable Cfg Memory Map Transactions
					oCore.byId("item1-5-5").setEnabled(true);

				// enable Cfg Shop Floor Computers
					oCore.byId("item1-6-1").setEnabled(true);
				// enable Cfg Shop Floor Printers
					oCore.byId("item1-6-2").setEnabled(true);
				// enable Cfg PCo Servers
					oCore.byId("item1-6-3").setEnabled(true);
				// enable Cfg PCo Agents
					oCore.byId("item1-6-4").setEnabled(true);
				// enable Cfg Sql Servers
					oCore.byId("item1-6-5").setEnabled(true);
				// enable Cfg Operators
					oCore.byId("item1-6-6").setEnabled(true);
				// enable Cfg File Servers
					oCore.byId("item1-6-7").setEnabled(true);
				// enable Cfg File Agents
					oCore.byId("item1-6-8").setEnabled(true);

				// Enable UOM Maintenance
					oCore.byId("item1-7-1").setEnabled(true);
				// Enable Product Maintenance
					oCore.byId("item1-7-2").setEnabled(true);
				// Enable BOM Maintenance
					oCore.byId("item1-7-3").setEnabled(true);
				// Enable Routing Maintenance
					oCore.byId("item1-7-4").setEnabled(true);

				// SPC
				// enable Plants  Maintenance
					oCore.byId("item1-8-1").setEnabled(true);
				// enable Import Plants
					oCore.byId("item1-8-2").setEnabled(true);
				// enable Export Plants
					oCore.byId("item1-8-3").setEnabled(true);

				// enable Stations   Maintenance
					oCore.byId("item1-9-1").setEnabled(true);
				// enable Import Stations
					oCore.byId("item1-9-2").setEnabled(true);
				// enable Export Stations
					oCore.byId("item1-9-3").setEnabled(true);

				// enable Parts Maintenance
					oCore.byId("item1-10-1").setEnabled(true);
				// enable Import Parts
					oCore.byId("item1-10-2").setEnabled(true);
				// enable Export Parts
					oCore.byId("item1-10-3").setEnabled(true);

				// enable Datapoints HDR
					oCore.byId("item1-11-1").setEnabled(true);
				// enable Datapoints SPC
					oCore.byId("item1-11-2").setEnabled(true);
				// enable Import Datapoints
					oCore.byId("item1-11-3").setEnabled(true);
				// enable Export Datapoints
					oCore.byId("item1-11-4").setEnabled(true);

				// enable Operatord Maintenance
					oCore.byId("item1-12-1").setEnabled(true);
				// enable Import Operators
					oCore.byId("item1-12-2").setEnabled(true);
				// enable  Export Operators
					oCore.byId("item1-12-3").setEnabled(true);
										
				// enable Subscriptions Maintenance 
					oCore.byId("item1-13-1").setEnabled(true);
				// enable Import Subscriptions
					oCore.byId("item1-13-2").setEnabled(true);
				// enable Export Subscriptions
					oCore.byId("item1-13-3").setEnabled(true);
	
				// update screen
				document.getElementById("page_title").innerHTML="ADM ALL PLANTS";
				oMatrixP.placeAt('mesm_content');
				oMatrixT.placeAt('mesm_content');
				oMatrixB.placeAt('mesm_content');
				break;
			case role_ADM:
				// enable Cfg Hierarchy
					oCore.byId("item1-0-1").setEnabled(true);
				// enable Cfg Memory Maps
					oCore.byId("item1-0-3").setEnabled(true);
				// enable Cfg Connectivity
					oCore.byId("item1-0-4").setEnabled(true);
				// enable Master Data
					oCore.byId("item1-0-5").setEnabled(true);

				// SPC
				// enable SPC home page
					oCore.byId("item1-0-6").setEnabled(true);
				// enable Plants submenu
					oCore.byId("item1-0-7").setEnabled(true);
				// enable  Stations submenu
					oCore.byId("item1-0-8").setEnabled(true);
				// enable Part submenu
					oCore.byId("item1-0-9").setEnabled(true);
				// enable   Datapoints submenu
					oCore.byId("item1-0-10").setEnabled(true);
				// enable Operators submenu
					oCore.byId("item1-0-11").setEnabled(true);
				// enable Subscriptions submenu
					oCore.byId("item1-0-12").setEnabled(true);

				// enable WO Management
					oCore.byId("item2-0-1").setEnabled(true);
				// enable Carrier Station Dashboard
					oCore.byId("item2-0-2").setEnabled(true);
				// enable Assembly Station Dashboard
					oCore.byId("item2-0-3").setEnabled(true);

				// SPC
				// enable SPC Dashboard
					oCore.byId("item2-0-4").setEnabled(true);
				// enable Saved File Charts
					//	oCore.byId("item2-0-5").setEnabled(true);
				// enable  PC History Logs
					//	oCore.byId("item2-0-6").setEnabled(true);

				// enable Production Status Report
					oCore.byId("item3-0-1").setEnabled(true);
				// enable Item Traceability Report
					oCore.byId("item3-0-2").setEnabled(true);
				// enable Connector Diagnostics
					oCore.byId("item3-0-3").setEnabled(true);

				// SPC
				// enable Daily Activity
					oCore.byId("item3-0-4").setEnabled(true);
				// enable Weekly Activity
					oCore.byId("item3-0-5").setEnabled(true);
				// enable onthly Activity
					oCore.byId("item3-0-6").setEnabled(true);

				// enable Equipment Hierarchy
					oCore.byId("item1-4-1").setEnabled(true);
				// enable Cfg Hierarchy Levels
					oCore.byId("item1-4-2").setEnabled(true);

				// enable Cfg Memory Maps
					oCore.byId("item1-5-1").setEnabled(true);
				// enable Cfg Tag Types
					oCore.byId("item1-5-2").setEnabled(true);
				// enable Cfg Tag Functions
					oCore.byId("item1-5-3").setEnabled(true);
				// enable Cfg Tag Groups
					oCore.byId("item1-5-4").setEnabled(true);
				// enable Cfg Memory Map Transactions
					oCore.byId("item1-5-5").setEnabled(true);

				// enable Cfg Shop Floor Computers
					oCore.byId("item1-6-1").setEnabled(true);
				// enable Cfg Shop Floor Printers
					oCore.byId("item1-6-2").setEnabled(true);
				// enable Cfg PCo Servers
					oCore.byId("item1-6-3").setEnabled(true);
				// enable Cfg PCo Agents
					oCore.byId("item1-6-4").setEnabled(true);
				// enable Cfg Sql Servers
					oCore.byId("item1-6-5").setEnabled(true);
				// enable Cfg Operators
					oCore.byId("item1-6-6").setEnabled(true);
				// enable Cfg File Servers
					oCore.byId("item1-6-7").setEnabled(true);
				// enable Cfg File Agents
					oCore.byId("item1-6-8").setEnabled(true);

				// Enable UOM Maintenance
					oCore.byId("item1-7-1").setEnabled(true);
				// Enable Product Maintenance
					oCore.byId("item1-7-2").setEnabled(true);
				// Enable BOM Maintenance
					oCore.byId("item1-7-3").setEnabled(true);
				// Enable Routing Maintenance
					oCore.byId("item1-7-4").setEnabled(true);

				// SPC
				// enable Plants  Maintenance
					oCore.byId("item1-8-1").setEnabled(true);
				// enable Import Plants
					oCore.byId("item1-8-2").setEnabled(true);
				// enable Export Plants
					oCore.byId("item1-8-3").setEnabled(true);

				// enable Stations   Maintenance
					oCore.byId("item1-9-1").setEnabled(true);
				// enable Import Stations
					oCore.byId("item1-9-2").setEnabled(true);
				// enable Export Stations
					oCore.byId("item1-9-3").setEnabled(true);

				// enable Parts Maintenance
					oCore.byId("item1-10-1").setEnabled(true);
				// enable Import Parts
					oCore.byId("item1-10-2").setEnabled(true);
				// enable Export Parts
					oCore.byId("item1-10-3").setEnabled(true);

				// enable Datapoints HDR
					oCore.byId("item1-11-1").setEnabled(true);
				// enable Datapoints SPC
					oCore.byId("item1-11-2").setEnabled(true);
				// enable Import Datapoints
					oCore.byId("item1-11-3").setEnabled(true);
				// enable Export Datapoints
					oCore.byId("item1-11-4").setEnabled(true);

				// enable Operatord Maintenance
					oCore.byId("item1-12-1").setEnabled(true);
				// enable Import Operators
					oCore.byId("item1-12-2").setEnabled(true);
				// enable  Export Operators
					oCore.byId("item1-12-3").setEnabled(true);
										
				// enable Subscriptions Maintenance 
					oCore.byId("item1-13-1").setEnabled(true);
				// enable Import Subscriptions
					oCore.byId("item1-13-2").setEnabled(true);
				// enable Export Subscriptions
					oCore.byId("item1-13-3").setEnabled(true);
	
				// update screen
				document.getElementById("page_title").innerHTML="ADM PLANT "+plant2Access;
				oMatrixP.placeAt('mesm_content');
				oMatrixT.placeAt('mesm_content');
				oMatrixB.placeAt('mesm_content');
				break;
			case "MESM_OPS_ALL":
				// enable WO Management
					oCore.byId("item2-0-1").setEnabled(true);
				// enable Carrier Station Dashboard
					oCore.byId("item2-0-2").setEnabled(true);
				// enable Assembly Station Dashboard
					oCore.byId("item2-0-3").setEnabled(true);

				// SPC
				// enable SPC Dashboard
					oCore.byId("item2-0-4").setEnabled(true);
				// enable Saved File Charts
					//	oCore.byId("item2-0-5").setEnabled(true);
				// enable  PC History Logs
					//	oCore.byId("item2-0-6").setEnabled(true);

				// enable Production Status Report
					oCore.byId("item3-0-1").setEnabled(true);
				// enable Item Traceability Report
					oCore.byId("item3-0-2").setEnabled(true);
				// enable Connector Diagnostics
					oCore.byId("item3-0-3").setEnabled(true);

				// SPC
				// enable Daily Activity
					oCore.byId("item3-0-4").setEnabled(true);
				// enable Weekly Activity
					oCore.byId("item3-0-5").setEnabled(true);
				// enable onthly Activity
					oCore.byId("item3-0-6").setEnabled(true);

				document.getElementById("page_title").innerHTML="OPS ALL PLANTS";
				oMatrixP.placeAt('mesm_content');
				oMatrixT.placeAt('mesm_content');
				oMatrixB.placeAt('mesm_content');
				break;
			case role_OPS:
		// enable WO Management
					oCore.byId("item2-0-1").setEnabled(true);
				// enable Carrier Station Dashboard
					oCore.byId("item2-0-2").setEnabled(true);
				// enable Assembly Station Dashboard
					oCore.byId("item2-0-3").setEnabled(true);

				// SPC
				// enable SPC Dashboard
					oCore.byId("item2-0-4").setEnabled(true);
				// enable Saved File Charts
					//	oCore.byId("item2-0-5").setEnabled(true);
				// enable  PC History Logs
					//	oCore.byId("item2-0-6").setEnabled(true);

				// enable Production Status Report
					oCore.byId("item3-0-1").setEnabled(true);
				// enable Item Traceability Report
					oCore.byId("item3-0-2").setEnabled(true);
				// enable Connector Diagnostics
					oCore.byId("item3-0-3").setEnabled(true);

				// SPC
				// enable Daily Activity
					oCore.byId("item3-0-4").setEnabled(true);
				// enable Weekly Activity
					oCore.byId("item3-0-5").setEnabled(true);
				// enable onthly Activity
					oCore.byId("item3-0-6").setEnabled(true);

				document.getElementById("page_title").innerHTML="OPS PLANT "+plant2Access;
				oMatrixP.placeAt('mesm_content');
				oMatrixT.placeAt('mesm_content');
				oMatrixB.placeAt('mesm_content');
				break;
			default:
				alert("MES Module Role Unknown: " + role2Access);
				break;
			}
		  }
	}

	// ************************************	MENU		******************************************************************************************************************************

	var timestamp = new Date().getTime();

	var jsFile=document.createElement('script');
	jsFile.setAttribute("type","text/javascript");
	jsFile.setAttribute("src", "Common/js/menu.js?ts="+timestamp);
	document.getElementsByTagName("head")[0].appendChild(jsFile);

	// ******************************************************************************************************************************************************************
	var oMatrixP = new sap.ui.commons.layout.MatrixLayout({
		id : 'MatrixP',
		layoutFixed : true,
		width: '1200px',
		columns : 5,
		widths : ['240px', '260px', '200px', '240px', '240px'] 
	});

	var oLabelLines = new sap.ui.commons.Label({
		id : 'L-Lines',
		visible : true,
		text : 'SELECTED LINE ' });
		
	var oLabelTransaction = new sap.ui.commons.Label({
		id : 'L-Transaction',
		visible : true,
		text : 'SELECTED TRANSACTION ' });

	var oLabelPlants = new sap.ui.commons.Label({
		id : 'L-Plants',
		visible : true,
		text : 'SELECTED PLANT ' });

	oMatrixP.createRow(oLabelLines,oLabelTransaction,"","",oLabelPlants);
   
	var oDropdownBoxLines = new sap.ui.commons.DropdownBox({
		id : "oBoxLinesList",
		tooltip : 'Lines',
		editable : true,
		width : '200px',
		change: function(oEvent){
			selectedLine = oDropdownBoxLines.getSelectedKey();
			updateTableRoutings();
		}
	});
	
	var oDropdownBoxTransactions = new sap.ui.commons.DropdownBox({
		id : "oBoxTransactionsList",
		tooltip : 'Status',
		editable : true,
		width : '260px',
		change: function(oEvent){
			selectedTransaction = oDropdownBoxTransactions.getSelectedKey();
			updateTableRoutings();
		}
	});

	var oDropdownBoxPlants = new sap.ui.commons.DropdownBox({
		id : "oBoxPlantList",
		tooltip : 'Plants',
		editable : true,
		width : '200px',
		change: function(oEvent){
			// alert(oEvent.oSource.getSelectedKey());
			var endplant = oDropdownBoxPlants.getSelectedItemId();
			var result = endplant.substring(6,endplant.length);
			selectedPlant = result;
			displayProductionLineList(selectedPlant);
		}
	})

	oMatrixP.createRow( oDropdownBoxLines,oDropdownBoxTransactions,"","",oDropdownBoxPlants );

	// ******************************************************************************************************************************************************************
	function updatePlants(idPlant) {
		var timestamp = new Date().getTime();
		getData("/XMII/Illuminator?QueryTemplate=MESM/PLANTS/TRANSACTIONS/getActivePlants_xAcute&Param.1="+idPlant+"&ts="+timestamp+"&Content-Type=text/xml", parseJsonPlantsList);
		function parseJsonPlantsList(jsondata){
			oDropdownBoxPlants.destroyItems();
			for (var i=0; i<jsondata.length; i++){
				item_id = jsondata[i]['ID'];
				item_key = jsondata[i]['PLANT'];
				item_text = jsondata[i]['DESC'];
				oItem = new sap.ui.core.ListItem("plant_"+item_id,{
					key : item_key,
					text : item_text });
				oDropdownBoxPlants.addItem(oItem);
			}
			oDropdownBoxPlants.setSelectedKey(idPlant);
			var endplant = oDropdownBoxPlants.getSelectedItemId();
			var result = endplant.substring(6,endplant.length);
			selectedPlant = result;
			displayProductionLineList(selectedPlant);
			displayTransactionsList();
			createTableColumnsRoutings();
		}
	};

	// ******************************************************************************************************************************************************************
	function displayProductionLineList(selPlant) {
		//alert(selPlant);
		var timestamp = new Date().getTime();
		getData("/XMII/Illuminator?QueryTemplate=MESM/ORDERS/QUERIES/get_ProductionLineListALL&Param.1="+selPlant+"&ts="+timestamp+"&Content-Type=text/xml", parseJsonProductionLineList);
		function parseJsonProductionLineList(jsondata){
			oDropdownBoxLines.destroyItems();
			for (var i=0; i<jsondata.length; i++){
				item_id = jsondata[i]['recordID'];
				item_key = jsondata[i]['recordID'];
				item_text = jsondata[i]['unitName'];
				oItem = new sap.ui.core.ListItem("line_"+item_id,{
					key : item_key,
					text : item_text });
				oDropdownBoxLines.addItem(oItem);
			}
			selectedLine = oDropdownBoxLines.getSelectedKey();
			createTableRoutings();
		}
	};

	// ******************************************************************************************************************************************************************
 	function displayTransactionsList() {
		var Param1 = 1;
		var timestamp = new Date().getTime();
		var paramStr = "Param.1="+encodeURIComponent(Param1);
		//alert(paramStr);
		var urlStr = "/XMII/Illuminator?QueryTemplate=MESM/MATERIALS/QUERIES/get_TransactionsList&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml";
		getData(urlStr, parseJsonStationsList);
		function parseJsonStationsList(jsondata){
			oDropdownBoxTransactions.destroyItems();
			for (var i=0; i<jsondata.length; i++){
				// alert(jsondata[i]['recordID'] + '   ' + jsondata[i]['trxName']);
				item_id = jsondata[i]['recordID'];
				item_key = jsondata[i]['recordID'];
				item_text = jsondata[i]['trxID'] + " - " + jsondata[i]['trxName'];
				if(item_id ==0){
					item_text =  jsondata[i]['trxName'];
				   }
				else{
					item_text = jsondata[i]['trxID'] +" - "  + jsondata[i]['trxName'];
				}
				oItem = new sap.ui.core.ListItem("trx_"+item_id,{
					key : item_key,
					text : item_text });
				oDropdownBoxTransactions.addItem(oItem);
			}
			//alert( selectedTransactionID);
			//oDropdownBoxTransactions.setSelectedKey( selectedTransactionID);
		}
	}

	// ******************************************************************************************************************************************************************	
	function createTableRoutings() {
		var timestamp = new Date().getTime();
		// alert(selectedPlant); 
		var Param1 = escapeSQLString(selectedLine);
		var Param2 = escapeSQLString(selectedTransaction);
		var paramStr = "Param.1="+encodeURIComponent(Param1)+"&Param.2="+encodeURIComponent(Param2);
		//	alert(paramStr);		
 		oModel.loadData("/XMII/Illuminator?QueryTemplate=MESM/MATERIALS/QUERIES/get_Routing&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml","",false);
		// alert(oModel.getXML());
		oTable.setModel(oModel);
		oTable.bindRows("/Rowset/Row");
	};
	
	// ******************************************************************************************************************************************************************	
	function updateTableRoutings() { 
		oTable.clearSelection();
		var timestamp = new Date().getTime();
		// alert(selectedPlant); 
	 	var Param1 = escapeSQLString(selectedLine);
		var Param2 = escapeSQLString(selectedTransaction);
	  	var paramStr = "Param.1="+encodeURIComponent(Param1)+"&Param.2="+encodeURIComponent(Param2);
	  	//alert(paramStr);		
 		oModel.loadData("/XMII/Illuminator?QueryTemplate=MESM/MATERIALS/QUERIES/get_Routing&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml","",false);
		oTable.getModel().refresh(true);
	};

	// ******************************************************************************************************************************************************************	
	function createTableColumnsRoutings() {
		//Define the columns and the control templates to be used
		oTable.addColumn(new sap.ui.table.Column({
			label: new sap.ui.commons.Label({text: "ORDER TYPE"}),
			template: new sap.ui.commons.TextView().bindProperty("text", "orderType"),
			sortProperty: "orderType",
			filterProperty: "orderType",
			width: "80px"
		}));
		oTable.addColumn(new sap.ui.table.Column({
			label: new sap.ui.commons.Label({text: "OPERATION"}),
			template: new sap.ui.commons.TextView().bindProperty("text", "operationID_SAP"),
			sortProperty: "operationID_SAP",
			filterProperty: "operationID_SAP",
			width: "80px"
		}));

		oTable.addColumn(new sap.ui.table.Column({
			label: new sap.ui.commons.Label({text: "STATION"}),
			template: new sap.ui.commons.TextView().bindProperty("text", "operationName"),
			sortProperty: "operationName",
			filterProperty: "operationName",
			width: "200px"
		}));
		oTable.addColumn(new sap.ui.table.Column({
			label: new sap.ui.commons.Label({text: "TRANSACTION"}),
			template: new sap.ui.commons.TextView().bindProperty("text", "transactionName"),
			sortProperty: "transactionName",
			filterProperty: "transactionName",
			width: "200px"
		}));

		oTable.addColumn(new sap.ui.table.Column({
			label: new sap.ui.commons.Label({text: "MODIFIED BY"}),
			template: new sap.ui.commons.TextView().bindProperty("text", "ModifiedBy"),
			sortProperty: "ModifiedBy",
			filterProperty: "ModifiedBy",
			width: "50px"
		}));

		oTable.addColumn(new sap.ui.table.Column({
			label: new sap.ui.commons.Label({text: "MODIFIED ON"}),
			template: new sap.ui.commons.TextView().bindProperty("text", "ModifiedOn"),
			sortProperty: "ModifiedOn",
			filterProperty: "ModifiedOn",
			width: "100px"
		}));

		oTable.addColumn(new sap.ui.table.Column({
			label: new sap.ui.commons.Label({text: "CREATED BY"}),
			template: new sap.ui.commons.TextView().bindProperty("text", "CreatedBy"),
			sortProperty: "CreatedBy",
			filterProperty: "CreatedBy",
			width: "50px"
		}));

		oTable.addColumn(new sap.ui.table.Column({
			label: new sap.ui.commons.Label({text: "CREATED ON"}),
			template: new sap.ui.commons.TextView().bindProperty("text", "CreatedOn"),
			sortProperty: "CreatedOn",
			filterProperty: "CreatedOn",
			width: "100px"
		}));
	
	}

	// ******************************************************************************************************************************************************************	
	var oMatrixT = new sap.ui.commons.layout.MatrixLayout({
		id : 'MatrixT',
		layoutFixed : true,
		width: '1200px',
		columns : 1,
		widths : ['1200px'] 
	});

	// ******************************************************************************************************************************************************************
	//Create an instance of the table control
	var oTable = new sap.ui.table.Table({
		visibleRowCount: nrRows,
		visibleRowCountMode: sap.ui.table.VisibleRowCountMode.Interactive,
		firstVisibleRow: 0,
		width: "1200px",
		selectionBehavior: sap.ui.table.SelectionBehavior.Row,
		selectionMode: sap.ui.table.SelectionMode.Single
	});

	// ******************************************************************************************************************************************************************
	oTable.attachRowSelectionChange(function(oEvent) {
		var selIndex = oTable.getSelectedIndex();
		selectedIndex = selIndex;
		if (selIndex  >= 0) {
			oButtonNew.setEnabled(false); 
			oButtonEdit.setEnabled(true); 
			oButtonDelete.setEnabled(true); 
		
			// Retrieve the selected row
			var selectedRow = oTable.getRows()[selIndex];
			var selectedRowContext = oEvent.getParameter("rowContext");

			selectedRoutingRecordID = oModel.getProperty("routingID", selectedRowContext);
			selectedOrderTypeID = oModel.getProperty("orderTypeID", selectedRowContext);
			selectedStationID = oModel.getProperty("operationStationRecordID", selectedRowContext);
			selectedTransactionID = oModel.getProperty("transactionRecordID", selectedRowContext);
			selectedOperationSap = oModel.getProperty("operationID_SAP", selectedRowContext);

		}
 		else {
			oButtonNew.setEnabled(true); 
			oButtonEdit.setEnabled(false); 
			oButtonDelete.setEnabled(false); 

			selectedRoutingRecordID = -1;
			selectedOrderTypeID = 0;
			selectedStationID = 0;
			selectedTransactionID = 0;

			// alert ("No Selection ..");
		}
	});

	var oModel =  new sap.ui.model.xml.XMLModel();

	//Bring the table onto the UI 
	oMatrixT.createRow(oTable);

	// ******************************************************************************************************************************************************************
	var oMatrixB = new sap.ui.commons.layout.MatrixLayout({
		id : 'MatrixB',
		layoutFixed : true,
		width: '1200px',
		columns : 5,
		widths : ['240px','240px','240px','240px','240px'] 
	});
	
	var oButtonNew = new sap.ui.commons.Button({
		id : 'B-New',
		tooltip : "Add New Order",
		text : 'Add',
		enabled: true
	});
	oButtonNew.attachPress(doNew);

	var oButtonEdit = new sap.ui.commons.Button({
		id : 'B-Edit',
		tooltip : "Edit",
		text : 'Edit',
		enabled: false
	});
	oButtonEdit.attachPress(doEdit);

	var oButtonDelete = new sap.ui.commons.Button({
		id : 'B-Delete',
		tooltip : "Delete",
		text : 'Delete',
		enabled: false
	});
	oButtonDelete.attachPress(doDelete);

	oMatrixB.createRow("",oButtonNew,oButtonEdit,oButtonDelete,"");
	
	// ******************************************************************************************************************************************************************
	var oMatrixAR = new sap.ui.commons.layout.MatrixLayout({
		id : 'MatrixAR',
		layoutFixed : true,
		width: '600px',
		columns : 1,
		widths : ['600px'] 
	});
	
	var oMatrixARF = new sap.ui.commons.layout.MatrixLayout({
		id : 'MatrixARF',
		layoutFixed : true,
		width: '600px',
		columns : 2,
		widths : ['225px','375px'] 
	});
	
	var oTitleAR = new sap.ui.commons.Label({
		id : 'L-AddRouting',
		text : 'ADD ROUTING'
	});
		
	oMatrixAR.createRow( oTitleAR );
	
	var oLabelLineAR = new sap.ui.commons.Label({
		id : 'L-LineAR',
		visible : true,
		text : 'ORDER TYPE' });
		
	var oDropdownBoxLineAR = new sap.ui.commons.DropdownBox({
		id : "oBoxLineListAR",
		tooltip : 'Lines',
		editable : true,
		width : '250px',
		change: function(oEvent){
			//	alert(oEvent.oSource.getSelectedKey());
			updateStationsListAR (oEvent.oSource.getSelectedKey());
			updateTransactionsListAR(oEvent.oSource.getSelectedKey());
		}
	})

	oMatrixARF.createRow(oLabelLineAR, oDropdownBoxLineAR);

	var oLabelOperationSapAR = new sap.ui.commons.Label({
		id : 'L-OperationSapAR',
		visible : true,
		text : 'OPERATION' });
	
	var oTF_OperationSapAR = new sap.ui.commons.TextField({
		id : 'TF-OperationSapAR',
		tooltip : 'Operation',
		editable : true,
		visible : true,
		width : '250px' 
	});
	
	oMatrixARF.createRow(oLabelOperationSapAR, oTF_OperationSapAR);

	var oLabelStationAR = new sap.ui.commons.Label({
		id : 'L-StationAR',
		visible : true,
		text : 'STATIONS' });
		
	var oDropdownBoxStationAR = new sap.ui.commons.DropdownBox({
		id : "oBoxStationAR",
		tooltip : 'Stations',
		editable : true,
		width : '250px',
		change: function(oEvent){
			 //alert(oEvent.oSource.getSelectedKey());
		}
	})

	oMatrixARF.createRow(oLabelStationAR, oDropdownBoxStationAR);

	var oLabelTransactionAR = new sap.ui.commons.Label({
		id : 'L-TransactionAR',
		visible : true,
		text : 'TRANSACTIONS' });
		
	var oDropdownBoxTransactionAR = new sap.ui.commons.DropdownBox({
		id : "oBoxTransactionAR",
		tooltip : 'Transactions',
		editable : true,
		width : '250px',
		change: function(oEvent){
			// alert(oEvent.oSource.getSelectedKey());
		}
	})

	oMatrixARF.createRow(oLabelTransactionAR, oDropdownBoxTransactionAR);
		
	oMatrixAR.createRow(oMatrixARF);
		
	var oButtonNewAR = new sap.ui.commons.Button({
		id : 'B-NewAR',
		tooltip : "Submit",
		text : 'Submit',
		enabled:true
	});
	oButtonNewAR.attachPress(doAddRouting);

	oMatrixAR.createRow(oButtonNewAR);

	var oOverlayContainerNew = new sap.ui.ux3.OverlayDialog({openButtonVisible: false});
	oOverlayContainerNew.setHeight('340px');
	oOverlayContainerNew.setWidth('660px');
	oOverlayContainerNew.addContent(oMatrixAR);

	// ******************************************************************************************************************************************************************
	function resetAddRouting() {
		oDropdownBoxStationAR.destroyItems();
		oDropdownBoxTransactionAR.destroyItems();
		oCore.byId("TF-OperationSapAR").setValue("");
	}

	function doNew() {
		if(!oOverlayContainerNew.isOpen()){
			resetAddRouting();
			updateProductionLineListAR() ;
			oOverlayContainerNew.open();
		}
	}

	// ******************************************************************************************************************************************************************
	function updateProductionLineListAR() {
		var timestamp = new Date().getTime();
		var Param1 = selectedPlantAR;
		var paramStr = "Param.1="+encodeURIComponent(Param1);
		//alert(paramStr);
		getData("/XMII/Illuminator?QueryTemplate=MESM/ORDERS/QUERIES/get_ProductionLineListALL&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml", parseJsonProductionLineList);
		function parseJsonProductionLineList(jsondata){
			oDropdownBoxLineAR.destroyItems();
			for (var i=0; i<jsondata.length; i++){
				//	alert(jsondata[i]['recordID'] + '  ' + jsondata[i]['unitName']);
				item_id = jsondata[i]['recordID'];
				item_key = jsondata[i]['recordID'];
				item_text = jsondata[i]['unitName'];
				oItem = new sap.ui.core.ListItem("lineAR_"+item_id,{
					key : item_key,
					text : item_text });
				oDropdownBoxLineAR.addItem(oItem);
			}
		}
	}

	// ******************************************************************************************************************************************************************
 	function updateStationsListAR(order_type) {
		var Param1 = order_type;
		var timestamp = new Date().getTime();
		var paramStr = "Param.1="+encodeURIComponent(Param1);
		//	alert(paramStr);
		var urlStr = "/XMII/Illuminator?QueryTemplate=MESM/ORDERS/QUERIES/get_LineStationsList&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml";
		getData(urlStr, parseJsonStationsList);
		function parseJsonStationsList(jsondata){
			oDropdownBoxStationAR.destroyItems();
			for (var i=0; i<jsondata.length; i++){
				// alert(jsondata[i]['recordID'] + '   ' + jsondata[i]['unitDescr']);
				item_id = jsondata[i]['recordID'];
				item_key = jsondata[i]['recordID'];
				item_text = jsondata[i]['unitDescr'];
				oItem = new sap.ui.core.ListItem("unitAR_"+item_id,{
					key : item_key,
					text : item_text });
				oDropdownBoxStationAR.addItem(oItem);
			}
		}
	}

	// ******************************************************************************************************************************************************************
 	function updateTransactionsListAR(revision_id) {
		var Param1 = 1;
		var timestamp = new Date().getTime();
		var paramStr = "Param.1="+encodeURIComponent(Param1);
		//alert(paramStr);
		var urlStr = "/XMII/Illuminator?QueryTemplate=MESM/ORDERS/QUERIES/get_TransactionsList&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml";
		getData(urlStr, parseJsonStationsList);
		function parseJsonStationsList(jsondata){
			oDropdownBoxTransactionAR.destroyItems();
			for (var i=0; i<jsondata.length; i++){
				// alert(jsondata[i]['recordID'] + '   ' + jsondata[i]['trxName']);
				item_id = jsondata[i]['recordID'];
				item_key = jsondata[i]['recordID'];
				item_text = jsondata[i]['trxID'] +" - "  + jsondata[i]['trxName'];
				oItem = new sap.ui.core.ListItem("trxAR_"+item_id,{
					key : item_key,
					text : item_text });
				oDropdownBoxTransactionAR.addItem(oItem);
			}
		}
	}

	// ******************************************************************************************************************************************************************
	function doAddRouting() {
		if(!(oDropdownBoxLineAR.getSelectedKey()>0)) {
			alert("Please Select Line ..");
			oCore.byId("oBoxLineListAR").focus();
			return;
		}
		var input_OperationSap = oCore.byId("TF-OperationSapAR").getValue();
		if(input_OperationSap=="") {
			alert("Please Input Opration ID");
			oCore.byId("TF-OperationSapAR").focus();
			return;
		}
		if(isNaN(input_OperationSap)) {
			alert("Please Input Numeric  Value");
			oCore.byId("TF-OperationSapAR").focus();
			return;
		}

		var input_OrderTypeID = oDropdownBoxLineAR.getSelectedKey();
		var input_StationID = oDropdownBoxStationAR.getSelectedKey();
		var input_TransactionID = oDropdownBoxTransactionAR.getSelectedKey();
		var input_userName = document.getElementById("user_name").value;
	
		// all good. Try to write them ..
		var Param1 = escapeSQLString(input_OrderTypeID);
		var Param2 = escapeSQLString(input_StationID);
		var Param3 = escapeSQLString(input_TransactionID);
		var Param4 = escapeSQLString(input_userName);
		var Param5 = escapeSQLString(input_OperationSap);
	
       		var oReqData;
      		if (window.XMLHttpRequest) {
     	     		oReqData = new XMLHttpRequest();
      		}
		if (oReqData != null) {
			var timestamp = new Date().getTime();
			var paramStr = "Param.1="+encodeURIComponent(Param1)+"&Param.2="+encodeURIComponent(Param2)+"&Param.3="+encodeURIComponent(Param3)+"&Param.4="+encodeURIComponent(Param4)+"&Param.5="+encodeURIComponent(Param5);
			// alert(paramStr);
			var queryStr = "/XMII/Illuminator?QueryTemplate=MESM/MATERIALS/QUERIES/add_Routing&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml";
			oReqData.open("GET", queryStr, true); 
			oReqData.onreadystatechange = function() {
				if (oReqData.readyState == 4) 
				if (oReqData.status == 200) {
					var response = oReqData.responseText;
					var sMessage = response.match("<Message>(.*)</Message>");
					if (sMessage != null) {
						// Successful -- rebuild the screen
						updateTableRoutings();
						oOverlayContainerNew.close();
					}
					else {
						var sError = response.match("<FatalError>(.*)</FatalError>")[1];
						//alert(sError);
						if (sError.indexOf("Violation of PRIMARY KEY contraint") > -1) {
							alert("The record already exists.");
						}
						else if (sError.indexOf("com.microsoft.sqlserver.jdbc.SQLServerException:") > -1) {
							alert(sError.replace("com.microsoft.sqlserver.jdbc.SQLServerException:",""));
						}
						else {
							alert(response.match("<FatalError>(.*)</FatalError>")[1]);
						}
					}
				} else {
					alert("Error: " + oReqData.statusText);
				}
			}
			oReqData.send();
       		} else {
          			window.alert("Error creating XmlHttpRequest object.");
       		}
	}

	// ******************************************************************************************************************************************************************
	var oMatrixER = new sap.ui.commons.layout.MatrixLayout({
		id : 'MatrixER',
		layoutFixed : true,
		width: '600px',
		columns : 1,
		widths : ['600px'] 
	});
	
	var oMatrixERF = new sap.ui.commons.layout.MatrixLayout({
		id : 'MatrixERF',
		layoutFixed : true,
		width: '600px',
		columns : 2,
		widths : ['225px','375px'] 
	});
		
	var oTitleER = new sap.ui.commons.Label({
		id : 'L-EditRouting',
		text : 'EDIT ROUTING'
	});
		
	oMatrixER.createRow( oTitleER );
	
	var oLabelLineER = new sap.ui.commons.Label({
		id : 'L-LineER',
		visible : true,
		text : 'ORDER TYPE' });
		
	var oDropdownBoxLineER = new sap.ui.commons.DropdownBox({
		id : "oBoxLineListER",
		tooltip : 'Lines',
		editable : true,
		width : '250px',
		change: function(oEvent){
			//	alert(oEvent.oSource.getSelectedKey());
			updateStationsListER (oEvent.oSource.getSelectedKey());
			updateTransactionsListER(oEvent.oSource.getSelectedKey());
		}
	})

	oMatrixERF.createRow(oLabelLineER, oDropdownBoxLineER);

	var oLabelOperationSapER = new sap.ui.commons.Label({
		id : 'L-OperationSapER',
		visible : true,
		text : 'OPERATION' });
	
	var oTF_OperationSapER = new sap.ui.commons.TextField({
		id : 'TF-OperationSapER',
		tooltip : 'Operation',
		editable : true,
		visible : true,
		width : '250px' 
	});
	
	oMatrixERF.createRow(oLabelOperationSapER, oTF_OperationSapER);

	var oLabelStationER = new sap.ui.commons.Label({
		id : 'L-StationER',
		visible : true,
		text : 'STATIONS' });
		
	var oDropdownBoxStationER = new sap.ui.commons.DropdownBox({
		id : "oBoxStationER",
		tooltip : 'Stations',
		editable : true,
		width : '250px',
		change: function(oEvent){
			 //alert(oEvent.oSource.getSelectedKey());
		}
	})

	oMatrixERF.createRow(oLabelStationER, oDropdownBoxStationER);

	var oLabelTransactionER = new sap.ui.commons.Label({
		id : 'L-TransactionER',
		visible : true,
		text : 'TRANSACTIONS' });
		
	var oDropdownBoxTransactionER = new sap.ui.commons.DropdownBox({
		id : "oBoxTransactionER",
		tooltip : 'Transactions',
		editable : true,
		width : '250px',
		change: function(oEvent){
			// alert(oEvent.oSource.getSelectedKey());
		}
	})

	oMatrixERF.createRow(oLabelTransactionER, oDropdownBoxTransactionER);
		
	oMatrixER.createRow(oMatrixERF);
		
	var oButtonNewER = new sap.ui.commons.Button({
		id : 'B-NewER',
		tooltip : "Submit",
		text : 'Submit',
		enabled:true
	});
	oButtonNewER.attachPress(doEditRouting);

	oMatrixER.createRow(oButtonNewER);

	var oOverlayContainerEdit = new sap.ui.ux3.OverlayDialog({openButtonVisible: false});
	oOverlayContainerEdit.setHeight('340px');
	oOverlayContainerEdit.setWidth('600px');
	oOverlayContainerEdit.addContent(oMatrixER);

	// ******************************************************************************************************************************************************************
	function doEdit() {
		if(!oOverlayContainerNew.isOpen()){
			resetEditRouting();
			updateProductionLineListER() ;
			oOverlayContainerEdit.open();
		}
	}

	// ******************************************************************************************************************************************************************
	function setEditRouting() {
	
	}

	// ******************************************************************************************************************************************************************
	function resetEditRouting() {
	
	}

	// ******************************************************************************************************************************************************************
	function updateProductionLineListER() {
		var timestamp = new Date().getTime();
		var Param1 = selectedPlantER;
		var paramStr = "Param.1="+encodeURIComponent(Param1);
		//alert(paramStr);
		getData("/XMII/Illuminator?QueryTemplate=MESM/ORDERS/QUERIES/get_ProductionLineListALL&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml", parseJsonProductionLineList);
		function parseJsonProductionLineList(jsondata){
			oDropdownBoxLineER.destroyItems();
			for (var i=0; i<jsondata.length; i++){
				//	alert(jsondata[i]['recordID'] + '  ' + jsondata[i]['unitName']);
				item_id = jsondata[i]['recordID'];
				item_key = jsondata[i]['recordID'];
				item_text = jsondata[i]['unitName'];
				oItem = new sap.ui.core.ListItem("lineER_"+item_id,{
					key : item_key,
					text : item_text });
				oDropdownBoxLineER.addItem(oItem);
			}
			oDropdownBoxLineER.setSelectedKey(selectedOrderTypeID);
			updateStationsListER (selectedOrderTypeID);
			updateTransactionsListER(selectedOrderTypeID);
			oCore.byId("TF-OperationSapER").setValue(selectedOperationSap);
		}
	}

	// ******************************************************************************************************************************************************************
 	function updateStationsListER(order_type) {
		var Param1 = order_type;
		var timestamp = new Date().getTime();
		var paramStr = "Param.1="+encodeURIComponent(Param1);
		//	alert(paramStr);
		var urlStr = "/XMII/Illuminator?QueryTemplate=MESM/ORDERS/QUERIES/get_LineStationsList&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml";
		getData(urlStr, parseJsonStationsList);
		function parseJsonStationsList(jsondata){
			oDropdownBoxStationER.destroyItems();
			for (var i=0; i<jsondata.length; i++){
				// alert(jsondata[i]['recordID'] + '   ' + jsondata[i]['unitDescr']);
				item_id = jsondata[i]['recordID'];
				item_key = jsondata[i]['recordID'];
				item_text = jsondata[i]['unitDescr'];
				oItem = new sap.ui.core.ListItem("unitER_"+item_id,{
					key : item_key,
					text : item_text });
				oDropdownBoxStationER.addItem(oItem);
			}
			oDropdownBoxStationER.setSelectedKey(selectedStationID);
		}
	}

	// ******************************************************************************************************************************************************************
 	function updateTransactionsListER(revision_id) {
		var Param1 = 1;
		var timestamp = new Date().getTime();
		var paramStr = "Param.1="+encodeURIComponent(Param1);
		//alert(paramStr);
		var urlStr = "/XMII/Illuminator?QueryTemplate=MESM/ORDERS/QUERIES/get_TransactionsList&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml";
		getData(urlStr, parseJsonStationsList);
		function parseJsonStationsList(jsondata){
			oDropdownBoxTransactionER.destroyItems();
			for (var i=0; i<jsondata.length; i++){
				// alert(jsondata[i]['recordID'] + '   ' + jsondata[i]['trxName']);
				item_id = jsondata[i]['recordID'];
				item_key = jsondata[i]['recordID'];
				item_text = jsondata[i]['trxID'] +" - "  +jsondata[i]['trxName'];
				oItem = new sap.ui.core.ListItem("trxER_"+item_id,{
					key : item_key,
					text : item_text });
				oDropdownBoxTransactionER.addItem(oItem);
			}
			//alert( selectedTransactionID);
			oDropdownBoxTransactionER.setSelectedKey( selectedTransactionID);
		}
	}

	// ******************************************************************************************************************************************************************
	function doEditRouting() {
		if(!(oDropdownBoxLineER.getSelectedKey()>0)) {
			alert("Please Select Line ..");
			oCore.byId("oBoxLineListER").focus();
			return;
		}
		var input_OperationSap = oCore.byId("TF-OperationSapER").getValue();
		if(input_OperationSap=="") {
			alert("Please Input Opration ID");
			oCore.byId("TF-OperationSapER").focus();
			return;
		}
		if(isNaN(input_OperationSap)) {
			alert("Please Input Numeric  Value");
			oCore.byId("TF-OperationSapER").focus();
			return;
		}

		var input_OrderTypeID = oDropdownBoxLineER.getSelectedKey();
		var input_StationID = oDropdownBoxStationER.getSelectedKey();
		var input_TransactionID = oDropdownBoxTransactionER.getSelectedKey();
		var input_userName = document.getElementById("user_name").value;
	
		// all good. Try to write them ..
		var Param1 = escapeSQLString(input_OrderTypeID);
		var Param2 = escapeSQLString(input_StationID);
		var Param3 = escapeSQLString(input_TransactionID);
		var Param4 = escapeSQLString(input_userName);
		var Param5 = escapeSQLString(selectedRoutingRecordID);
		var Param6 = escapeSQLString(input_OperationSap);
	
       		var oReqData;
      		if (window.XMLHttpRequest) {
     	     		oReqData = new XMLHttpRequest();
      		}
		if (oReqData != null) {
			var timestamp = new Date().getTime();
			var paramStr = "Param.1="+encodeURIComponent(Param1)+"&Param.2="+encodeURIComponent(Param2)+"&Param.3="+encodeURIComponent(Param3)+"&Param.4="+encodeURIComponent(Param4)+"&Param.5="+encodeURIComponent(Param5)+"&Param.6="+encodeURIComponent(Param6);
			//alert(paramStr);
			var queryStr = "/XMII/Illuminator?QueryTemplate=MESM/MATERIALS/QUERIES/edit_Routing&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml";
			oReqData.open("GET", queryStr, true); 
			oReqData.onreadystatechange = function() {
				if (oReqData.readyState == 4) 
				if (oReqData.status == 200) {
					var response = oReqData.responseText;
					var sMessage = response.match("<Message>(.*)</Message>");
					if (sMessage != null) {
						// Successful -- rebuild the screen
						updateTableRoutings();
						oOverlayContainerEdit.close();
					}
					else {
						var sError = response.match("<FatalError>(.*)</FatalError>")[1];
						//alert(sError);
						if (sError.indexOf("Violation of PRIMARY KEY contraint") > -1) {
							alert("The record already exists.");
						}
						else if (sError.indexOf("com.microsoft.sqlserver.jdbc.SQLServerException:") > -1) {
							alert(sError.replace("com.microsoft.sqlserver.jdbc.SQLServerException:",""));
						}
						else {
							alert(response.match("<FatalError>(.*)</FatalError>")[1]);
						}
					}
				} else {
					alert("Error: " + oReqData.statusText);
				}
			}
			oReqData.send();
       		} else {
          			window.alert("Error creating XmlHttpRequest object.");
       		}
	}

	// ******************************************************************************************************************************************************************
	function doDelete(){
		var Param1 = escapeSQLString(selectedRoutingRecordID);
	
       		var oReqData;
      		if (window.XMLHttpRequest) {
     	     		oReqData = new XMLHttpRequest();
      		}
		if (oReqData != null) {
			var timestamp = new Date().getTime();
			var paramStr = "Param.1="+encodeURIComponent(Param1);
			//	alert(paramStr);
			var queryStr = "/XMII/Illuminator?QueryTemplate=MESM/MATERIALS/QUERIES/delete_Routing&"+paramStr+"&ts="+timestamp+"&Content-Type=text/xml";
			oReqData.open("GET", queryStr, true); 
			oReqData.onreadystatechange = function() {
				if (oReqData.readyState == 4) 
				if (oReqData.status == 200) {
					var response = oReqData.responseText;
					var sMessage = response.match("<Message>(.*)</Message>");
					if (sMessage != null) {
						// Successful -- rebuild the screen
						updateTableRoutings();
					}
					else {
						var sError = response.match("<FatalError>(.*)</FatalError>")[1];
						//alert(sError);
						if (sError.indexOf("Violation of PRIMARY KEY contraint") > -1) {
							alert("The record already exists.");
						}
						else if (sError.indexOf("com.microsoft.sqlserver.jdbc.SQLServerException:") > -1) {
							alert(sError.replace("com.microsoft.sqlserver.jdbc.SQLServerException:",""));
						}
						else {
							alert(response.match("<FatalError>(.*)</FatalError>")[1]);
						}
					}
				} else {
					alert("Error: " + oReqData.statusText);
				}
			}
			oReqData.send();
       		} else {
          			window.alert("Error creating XmlHttpRequest object.");
       		}
	}

	</script>
</head>

<body onLoad="roleSecurity()">

<input id="user_roles" type="hidden" value="{IllumLoginRoles}" style="display:block;width:1000px;" readonly />
<input id="user_role" type="hidden" value="{ROLE}" style="display:block;width:1000px;" readonly />
<input id="user_name" type="hidden" value="{IllumLoginName}" style="display: block;width:1000px;" readonly />
<input id="user_height" type="hidden" value="{HEIGHT}" style="display: block;width:100px;" readonly />
<input id="user_address" type="hidden" value="{Machine}" style="display:block;width:1000px;" readonly />
<input id="user_email" type="hidden" value="{email}" style="display:block;width:800px;" readonly />
<input id="user_firstname" type="hidden" value="{firstname}" style="display:block;width:800px;" readonly />
<input id="user_lastname" type="hidden" value="{lastname}" style="display:block;width:800px;" readonly />
<div id="app_header" >
	<div id="app_title">ROUTING MGMT</div>
	<div id="app_menu"></div>
	<div id="page_title">DEFAULT SCREEN</div>
</div>
<div id="mesm_content" ></div>
</body>
</html>